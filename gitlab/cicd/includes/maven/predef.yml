# A set of pre-defined maven stages, job template.
stages:
  - check
  - build
  - deploy
  - verify


# Job only template for integration
.for_it:
  only:
    - /^it\/.+/

test:
  stage: check
  script:
    - mvn test jacoco:report
    # print coverage report for pipeline
    - cat target/site/jacoco/index.html
  coverage: '/Total.*?([0-9]{1,3})%/'    
  artifacts:
    when: on_success
    paths:
      - target/site/jacoco/
    reports:
      junit:
        - target/surefire-reports/TEST-*.xml

pages:      
  stage: deploy
  dependencies:
    - test
  artifacts:
    paths:
      - public
    expire_in: 1 days
  script:
    - mv target/site/jacoco/ public/
